<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Detalle de Pedido</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    .box { border:1px solid #000; padding:2rem; max-width:500px; margin:2rem auto; display:flex; flex-direction:column; gap:1rem; background-color:#fff; }
    .panel-box { border:1px solid #000; padding:1rem; margin-top:1rem; border-radius:0; }
    .success { background-color:#d5e8d4; border-color:#82b366; }
    .warning { background-color:#fff3cd; border-color:#856404; }
    .error { background-color:#f8d7da; border-color:#c9302c; }
  </style>
</head>
<body>
  <div class="container">

    <div class="box">
      <h3 class="text-center">Detalle de Pedido</h3>


      <div class="mb-3">
        <label>Producto 1</label>
        <input type="text" class="form-control" id="prod1" placeholder="Nombre">
        <input type="number" class="form-control mt-1" id="cant1" placeholder="Cantidad" min="1" value="1">
        <input type="number" class="form-control mt-1" id="precio1" placeholder="Precio unitario" min="0" value="100">
      </div>
      <div class="mb-3">
        <label>Producto 2</label>
        <input type="text" class="form-control" id="prod2" placeholder="Nombre">
        <input type="number" class="form-control mt-1" id="cant2" placeholder="Cantidad" min="1" value="1">
        <input type="number" class="form-control mt-1" id="precio2" placeholder="Precio unitario" min="0" value="150">
      </div>
      <div class="mb-3">
        <label>Producto 3</label>
        <input type="text" class="form-control" id="prod3" placeholder="Nombre">
        <input type="number" class="form-control mt-1" id="cant3" placeholder="Cantidad" min="1" value="1">
        <input type="number" class="form-control mt-1" id="precio3" placeholder="Precio unitario" min="0" value="200">
      </div>

      <button id="btnVerDetalle" class="btn btn-primary w-100">Ver Detalle</button>
      <button id="btnDescargar" class="btn btn-secondary w-100 mt-2">Descargar PDF</button>
    </div>

    <div class="panel-box success" id="pedido-mostrado" style="display:none;">
      <h5>Pedido Confirmado</h5>
      <p id="resumen-pedido"></p>
    </div>

    <div class="panel-box warning" id="pdf-generado" style="display:none;">
      <h5>PDF Generado</h5>
      <p>Archivo con informaci√≥n completa del pedido</p>
    </div>

    <div class="panel-box error" id="pedido-vacio" style="display:none;">
      <h5>Error</h5>
      <p>No hay productos en el pedido</p>
    </div>

  </div>

  <script>

    class Producto {
      constructor(nombre, cantidad, precio) {
        this.nombre = nombre;
        this.cantidad = cantidad;
        this.precio = precio;
        this.subtotal = cantidad * precio;
      }
      toString() {
        return `${this.nombre} x ${this.cantidad} = $${this.subtotal}`;
      }
    }

    class Pedido {
      constructor() {
        this.productos = [];
      }

      mostrarListaBase() {
        this.productos = [
          new Producto("Queso Cheddar", 2, 1000),
          new Producto("Queso Parmesano", 2, 1500),
          new Producto("Queso Azul", 1, 1200)
        ];
        return this.productos;
      }

      obtenerDesdeFormulario() {
        this.productos = [];
        for (let i = 1; i <= 3; i++) {
          const nombre = document.getElementById("prod" + i).value.trim();
          const cantidad = parseInt(document.getElementById("cant" + i).value);
          const precio = parseFloat(document.getElementById("precio" + i).value);
          if (nombre) this.productos.push(new Producto(nombre, cantidad, precio));
        }
      }

      validarCarrito() {
        return this.productos.length > 0;
      }

      confirmarPedido() {
        if (!this.validarCarrito()) {
          return { status: "error", mensaje: "No hay productos en el pedido" };
        }
        const total = this.productos.reduce((sum, p) => sum + p.subtotal, 0);
        return {
          status: "ok",
          mensaje: "Pedido confirmado",
          lista: this.productos,
          total
        };
      }
    }

  
    const pedido = new Pedido();

    const btnVerDetalle = document.getElementById("btnVerDetalle");
    const btnDescargar = document.getElementById("btnDescargar");


    window.addEventListener("DOMContentLoaded", () => {
      const base = pedido.mostrarListaBase();
      base.forEach((p, i) => {
        document.getElementById("prod" + (i + 1)).value = p.nombre;
        document.getElementById("cant" + (i + 1)).value = p.cantidad;
        document.getElementById("precio" + (i + 1)).value = p.precio;
      });
    });


    btnVerDetalle.addEventListener("click", () => {
      document.getElementById("pedido-mostrado").style.display = "none";
      document.getElementById("pedido-vacio").style.display = "none";

      pedido.obtenerDesdeFormulario();
      const respuesta = pedido.confirmarPedido();

      if (respuesta.status === "error") {
        document.getElementById("pedido-vacio").style.display = "block";
        return;
      }

      const resumen = respuesta.lista.map(p => p.toString()).join(", ");
      document.getElementById("resumen-pedido").innerText = `${resumen} | Total: $${respuesta.total}`;
      document.getElementById("pedido-mostrado").style.display = "block";
    });

    btnDescargar.addEventListener("click", () => {
      pedido.obtenerDesdeFormulario();
      if (!pedido.validarCarrito()) {
        alert("No hay productos en el pedido");
        return;
      }
      document.getElementById("pdf-generado").style.display = "block";
    });
  </script>
</body>
</html>
